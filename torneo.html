<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Higashikita - Torneo</title>
    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <div class="brand">
          <img src="assets/img/logoHiga.jpg" class="logo" alt="" />
          <span id="page-subtitle">Torneo Spiller</span>
        </div>
        <nav class="nav">
          <a href="./tornei.html" class="btn btn-ghost small">← Tornei</a>
        </nav>
      </div>
    </header>

    <main class="container content">
      <section class="panel">
        <div class="split">
          <div id="content" style="max-width: 800px;">
            Caricamento in corso...
          </div>
          <div class="note muted small">
            <p><strong>Nota privacy:</strong> i dati raccolti servono unicamente per la gestione del torneo.</p>
            <p><strong>Privacy notice:</strong> data collected solely for tournament purposes.</p>
            <p id="registration-container">
               </p>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Pre-iscritti</h2>
        <div class="iscritti-grid" id="iscritti"></div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p>© 2026 Higashikita Go FVG</p>
        <div class="social">
          <a href="https://www.facebook.com/groups/612754198805804/" target="_blank"><img src="assets/img/facebook.svg" alt=""/></a>
        </div>
      </div>
    </footer>

    <script src="assets/js/sheet-loader.js"></script>
    <script>
      const params = new URLSearchParams(window.location.search);
      const fileName = params.get('f');

      if (fileName) {
        fetch(`tornei/${fileName}.md`)
          .then(response => {
            if (!response.ok) throw new Error("File non trovato");
            return response.text();
          })
          .then(text => {
            const parts = text.split('---');
            let mdContent = text;

            if (parts.length >= 3) {
              const header = parts[1];
              mdContent = parts.slice(2).join('---');

              // 1. Estrazione Link CSV
              const csvMatch = header.match(/csv_link:\s*"(.+?)"/);
              if (csvMatch && typeof loadIscritti === 'function') {
                loadIscritti(csvMatch[1], "#iscritti");
              }

              // 2. Estrazione Link Form
              const formMatch = header.match(/form_link:\s*"(.+?)"/);
              if (formMatch) {
                document.getElementById('registration-container').innerHTML = 
                  `<a class="btn btn-primary" href="${formMatch[1]}" target="_blank">Iscriviti / Register</a>`;
              }
            }

            // 3. Rendering Markdown
            document.getElementById('content').innerHTML = marked.parse(mdContent);
            document.title = fileName.replace(/-/g, ' ') + " - Club Go FVG";
          })
          .catch(err => {
            document.getElementById('content').innerHTML = `<h1>Errore</h1><p>Torneo non trovato.</p>`;
          });
      }
    </script>
  </body>
</html>
